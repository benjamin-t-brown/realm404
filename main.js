(()=>{let e=!1,t=()=>{pl(!1);let t=ut("map");sl(t),F(t),e?Al("start"):(e=!0,s()),Jl()};window.addEventListener("load",async()=>{await ge([["packed","packed.png",16,16,2,2,["map","t","a","misc"]]]),p(),t()});let l=(e,t,l)=>{if(0===l)return[[e,t]];{let l=[];for(let r=-1;r<=1;r++)for(let n=-1;n<=1;n++)l.push([e+n,t+r]);return l}},r=(e,t)=>Math.floor(Math.random()*(t-e)+e),n=e=>e[r(0,e.length)],i=(e,t,l,r,n,i)=>e>=l&&e<=n&&t>=r&&t<=i,o=(e,t,l,n,i)=>{if(t===e)return 0;let[o,a]=l,s=r(o,a);ae(N(t),-s);let[f,c]=K(t),u=Ft(15,f,c,""+s),h=Vt(i);return Pt(h,u),le(e,!0),n&&Al(n),s},a=[(e,t)=>{},(e,t)=>{let l=(e,t)=>{let[l,r]=K(e),[n,i]=K(t);return[n-l,i-r]};if(((e,t)=>{let[r,n]=l(e,t);return Math.abs(r)<6&&Math.abs(n)<6})(e,Mt(t.player))){let r=((e,t)=>{let[r,n]=l(e,t);return 0===n?r>0?[T]:[E]:0===r?n>0?[M]:[x]:r>0&&n>0?[z,M,T]:r>0&&n<0?[S,x,T]:r<0&&n>0?[$,M,E]:[D,x,E]})(e,Mt(t.player));for(let l in r)if(L(e,r[l],t))break}}],s=async()=>{let e="Heh, yer trapped here, friend.\n  Welcome to Realm 404.\n  Why's it called that?\n  Yer might say, the only way to escape...\n  ...is to tribute 404 coins to the fountain.\n  Put 'em in the fountain...\n  ...and ye might fight the Lord to leave.\n  But be wary.\n  This place be dangerous.\n  Death can come at any time.\n  But... I can aid you.\n  I'll buy any items you find.\n  For a fair price...\n  Heh heh heh...".split("\n"),t="a_12_f",l={d:"a_12",2:t,3:t,4:"t_13",5:"t_13",6:"t_13_f",10:t,11:t};El(!0);let r=fl();for(let t in e)Tl(e[t]),Dl(l[t]||l.d),Jl(),Ll(),Al("talk"),await m();Tl(""),Dl(""),El(!1),Jl(),F(r),Al("start")},f=!1,c=!1,u=e=>{let t=al();f?c||(c=!0,setTimeout(()=>{f=!1,c&&(c=!1,u(e))},16)):(f=!0,Ll(),Gl(e,t))},h=!1,d=null,m=async()=>new Promise(e=>{h=!0,d=()=>{d=null,h=!1,e()}}),p=()=>{let e={40:M,34:z,35:$,37:E,12:_,39:T,36:D,38:x,33:S,32:_,98:M,99:z,97:$,100:E,101:_,102:T,103:D,104:x,105:T};window.addEventListener("keydown",t=>{let l=fl();if(ml())return;if(h&&d)return void d();Tl("");let{which:r}=t,n=e[r]||r;switch(!0){case(o=+n)>=1&&o<=9:i=n,g(),A(l.player,i,l);break;case 27===n:g(),Jl(),u(l);break;default:{let e=Mt(l.player),t=Vt(l);if(n>48&&n<=57){let t=n-49,l=X(e)[t];if(l){let r=mt(l);wt(l)?(bl(t),v(r,e)):kt(l)&&b(t,e)}}if(n>=65&&n<=72){let l=Ut(t,e),r=n-65,[i,o,a]=l[r]||[];i&&k(i,e,o,a,t)}}}var i,o});let t=we();t.onmousemove=e=>{let t=fl(),r=al();if(vl()){let{offsetX:n,offsetY:i}=e,o=xl(),a=Mt(t.player),[s,f]=K(a),c=hl()*r,h=s*c+c/2,d=f*c+c/2,m=Math.floor(n/c),p=Math.floor(i/c);jl(h,d,n,i),Xt(l(m,p,o),Vt(t)),u(t)}else Kl()},t.onmousedown=e=>{let t=yl();if(t){let l=fl(),{offsetX:r,offsetY:n}=e,i=2*hl();t(Math.floor(r/i),Math.floor(n/i)),u(l)}}},g=()=>{Kl(),kl(),Wt(Vt(fl()));let e=yl();e&&e(-1,-1)},y=(e,t,l,r,i)=>{let o;if(1===e)o=i?Fe:Ce;else if(2===e)o=i?Pe:Ie;else{if(3!==e)return;o=i?Be:qe}let a=n(o);Gt(r,a,t,l)},w=(e,t)=>{let[l,r]=K(e);y(t.lvl,l,r,t)},v=async(e,t)=>{Al("use"),Jl(),await vt(e)(t)&&(j(t,e),bl(-1)),Jl()},b=async(e,t)=>{Al("eqp"),J(t,e),Jl()},k=(e,t,l,r,n)=>{let i=mt(e),o=ht(i);Rt(n,o,l,r),bt(e)&&(O(t,e),Al("acquire")),Jl(),F(fl())},x="8",M="2",E="4",_="5",T="6",D="7",S="9",$="1",z="3",A=(e,t,l)=>{let r=Mt(e);L(r,t,l),(e=>{let t=Mt(e),[l,r]=K(t),[n,i]=e,o=n,a=i,s=cl();return l<0&&(n--,l=s-1),r<0&&(i--,r=s-1),l>=s&&(n++,l=0),r>=s&&(i++,r=0),Dt(e,n,i),Q(t,l,r),o!==n||a!==i})(e)?F(l):C()},L=(e,t,l)=>{let n=Vt(l),[i,o,a,s,f]=((e,t,l)=>{let[r,n]=K(e),i=r,o=n;switch(t){case x:n--;break;case M:n++;break;case E:r--;break;case T:r++;break;case D:r--,n--;break;case S:r++,n--;break;case $:r--,n++;break;case z:r++,n++}let a=r,s=n,f=[i,o,a,s,!1],c=Vt(l);if(c){let e=qt(c,r,n);if(e&&!jt(e))return f;if(It(c,r,n))return f}return[r,n,a,s,!0]})(e,t,l);((e,t,l)=>{let[r,n]=K(e),i=r-t;Z(e,i>0?U:0===i?n-l>0?Y:U:Y)})(e,a,s),Q(e,i,o);let c=It(n,a,s),u=oe(e);return c&&u!==oe(c)?(((e,t,l)=>{if(t===e)return 0;let[n,i]=fe(e),o=r(n,i+1);ae(N(t),-o);let[a,s]=K(t),f=Ft(0,a,s,""+o),c=Vt(l);Pt(c,f),le(e,!0),Al("strike")})(e,c,l),!0):f},C=()=>{pl(!0);let e=fl(),t=Vt(e);for(let e=0;e<t.a.length;e++)ee(t.a[e],!0);I()},F=e=>{let t=Vt(e),l=Mt(e.player),[r,n]=K(l);B(r,n,t),Ll(),Gl(e,2)},I=()=>{let e=fl(),l=Vt(e);if(l.p.length){for(let e=0;e<l.p.length;e++){let t=l.p[e],[,r,n]=t;+new Date-r>=n&&(l.p.splice(e,1),e--)}return setTimeout(I,16),void F(e)}let r=Mt(e.player);if(re(r),ne(r))return Al("lose"),void setTimeout(()=>{t()},2e3);for(let t=0;t<l.a.length;t++){let r=l.a[t];if(ne(r))l.a.splice(t,1),t--,w(r,l),Al("dead"),r[13]&&r[13]();else{if(te(r)){ee(r,!1);let t=ie(r);return(0,a[t])(r,e),void setTimeout(I,1)}re(r)}}F(e),Jl(),setTimeout(()=>{pl(!1)},16)},P=()=>{El(!0),Sl(!0),Al("win"),setTimeout(()=>{Ll()})};window.finalRoom=()=>{Al("sell");let e=fl(),t=e.player,l=Mt(t);Tt(e.player,-404);let[r,n]=e.end;Dt(t,r,n),Q(l,6,11);let i=Vt(e),o=["Lord","a",14,11,6,Ge(150),[Se],0,1,!0,!1,2,0,P];i.a.push(o),Tl("Who dares challenge me!"),F(e),Jl()};let q=e=>{let t=[];for(var l=0;l<e[0];++l)t.push(1===e.length?0:q(e.slice(1)));return t},B=(e,t,l)=>{let r=cl(),n=q([r,r]),i=(e,t,r,i)=>{let o=1,a=Math.abs(r-e),s=e<r?1:-1,f=Math.abs(i-t),c=t<i?1:-1,u=(a>f?a:-f)/2,h=0;for(;h++,!(h>10);){let h=e,d=t;if(void 0===n[d]||void 0===n[d][h])continue;if(0!==n[d][h]&&1!==o||(n[d][h]=o),Kt(qt(l,h,d))&&(o=0),e===r&&t===i)break;let m=u;m>-a&&(u-=f,e+=s),m<f&&(u+=a,t+=c)}};for(let l=-7;l<=7;l++)i(e,t,e+l,t+7),i(e,t,e+l,t-7),i(e,t,e+7,t+l),i(e,t,e-7,t+l);n[t][e]=1,((e,t)=>{for(let l=0;l<t.length;l++)for(let r=0;r<t[0].length;r++)e[l][r]=e[l][r]||t[l][r]})(l.explMap,n),l.visMap=n};var G,H=.3;H=.3,G=(e=1,t=.05,l=220,r=0,n=0,i=.1,o=0,a=1,s=0,f=0,c=0,u=0,h=0,d=0,m=0,p=0,g=0,y=1,w=0,v=44100,b=99+r*v,k=n*v,x=i*v,M=w*v,E=g*v,_=2*Math.PI,T=(e=>0<e?1:-1),D=b+M+k+x+E,S=(s*=500*_/v**2),$=(l*=(1+2*t*Math.random()-t)*_/v),z=T(m)*_/4,A=0,L=0,C=0,F=0,I=0,P=0,q=1,B=[],G=zzfxX.createBufferSource(),R=zzfxX.createBuffer(1,D,v))=>{for(G.connect(zzfxX.destination);C<D;B[C++]=P)++I>100*p&&(I=0,P=A*l*Math.sin(L*m*_/v-z),P=T(P=o?1<o?2<o?3<o?Math.sin((P%_)**3):Math.max(Math.min(Math.tan(P),1),-1):1-(2*P/_%2+2)%2:1-4*Math.abs(Math.round(P/_)-P/_):Math.sin(P))*Math.abs(P)**a*e*H*(C<b?C/b:C<b+M?1-(C-b)/M*(1-y):C<b+M+k?y:C<D-E?(D-C-E)/x*y:0),P=E?P/2+(E>C?0:(C<D-E?1:(C-D)/E)*B[C-E|0]/2):P),A+=1-d+1e9*(Math.sin(C)+1)%2*d,L+=1-d+1e9*(Math.sin(C)**2+1)%2*d,l+=s+=500*f*_/v**3,q&&++q>u*v&&(l+=c*_/v,$+=c*_/v,q=0),h&&++F>h*v&&(l=$,s=S,F=1,q=q||1);return R.getChannelData(0).set(B),G.buffer=R,G.start(),G},zzfxX=new AudioContext;let R,U=0,Y=1,N=e=>e[5],X=e=>e[6],W=(e,t,l)=>{let r=X(e),n=mt(t),i=ht(n);for(let n=0;n<r.length;n++){let o=r[n],a=mt(o);if(i===ht(a)){if(l){let e=pt(t),l=gt(o,e);r[n]=l}else{let t=gt(o,-1);if(t)r[n]=t;else{let t=V(e),l=e[12];if(t){let r=mt(t);ht(r)===i?J(e,-1):l>n&&J(e,l-1)}r.splice(n,1)}}return}}l&&r.push(t)},O=(e,t)=>{W(e,t,!0)},j=(e,t)=>{W(e,t,!1)},K=e=>e.slice(3,5),Q=(e,t,l)=>{e[3]=t,e[4]=l},V=e=>X(e)[e[12]]||null,J=(e,t)=>{e[12]=t},Z=(e,t)=>{e[7]=t},ee=(e,t)=>{e[9]=t},te=e=>e[9],le=(e,t)=>{e[10]=t},re=e=>{le(e,!1)},ne=e=>se(N(e))<=0,ie=e=>e[8],oe=e=>0===ie(e)?0:1,ae=(e,t)=>{e[0]+=t,e[0]<0?e[0]=0:e[0]>e[1]&&(e[0]=e[1])},se=e=>e[0],fe=e=>{let t=V(e),[l,r]=[1,3];if(t){let[n,i]=xt(mt(t),e);l+=n,r+=i}return[l,r]},ce=null,ue=null,he=null,de=e=>{let[t,l,r,n]=ye(e.width,e.height),i=r/2,o=n/2;return l.translate(i,o),l.rotate(Math.PI/2),l.drawImage(e,-i,-o),t},me=e=>{let[t,l,r]=ye(e.width,e.height);return l.translate(r,0),l.scale(-1,1),l.drawImage(e,0,0),t},pe=e=>{let[,,,t,l]=e,[r,n]=ye(t,l);return Fl(e,0,0,1,n),r},ge=async e=>{let t={},l={};await Promise.all(e.map(([e,r,n,i,o,a,s])=>new Promise(f=>{let c=new Image;c.onload=()=>{t[e]=c,((e,t,l,r,n,i,o)=>{let a=(t,l,r,n,i,o)=>e[t]=[l,r,n,i,o],s=(e,t,l)=>{let i=e;for(let e=0;e<l;e++)i=de(i);a(`${t}_r${l}`,i,0,0,r,n)},f=t.width/r/i,c=t.height/n/o;for(let e=0;e<o;e++)for(let o=0;o<i;o++){let u=l[e*i+o],h=0;for(let l=0;l<c;l++)for(let i=0;i<f;i++){let d=`${u}_${h}`,m=a(`${u}_${h}`,t,o*r*f+i*r,e*n*c+l*n,r,n);s(pe(m),d,1),s(pe(m),d,2),s(pe(m),d,3);let p=me(pe(m));a(d+"_f",p,0,0,r,n),h++}}})(l,c,s,n,i,o,a),f()},c.src=r}))),ue=t,he=l},ye=(e,t)=>{let l=document.createElement("canvas");l.width=e,l.height=t;let r=l.getContext("2d");return r.imageSmoothingEnabled=!1,[l,r,e,t]},we=()=>{if(ce)return ce;{let[e,t]=ye(576,576);return e.id="canv",t.lineWidth=2,window.canvasDiv.appendChild(e),ce=e,e}},ve=()=>we().getContext("2d"),be=async(e,t,r,n,i,a)=>{if(a=a||await(async e=>new Promise(t=>{wl(!0),Ml(e),gl((e,l)=>{e>-1&&l>-1?(Kl(),kl(),t([e,l])):t(null),gl(null),g()})}))(r)){let s=fl(),[f,c]=a,u=l(f,c,r),h=!1;for(let l=0;l<u.length;l++){let[r,a]=u[l],f=It(Vt(s),r,a);f&&0===e&&(o(t,f,n,h?"":i,s),h=!0)}return h?(C(),!0):(Al("cancel"),!1)}return!1},ke=(e,t)=>()=>(Al("gold"),Tt(fl().player,r(e,t)),!1),xe=[13,"Gold S",{onAcq:ke(5,10)},0],Me=[13,"Gold M",{onAcq:ke(10,20)},1],Ee=[13,"Gold L",{onAcq:ke(20,30)},1],_e=[14,"Key",{async onUse(e){let t=fl(),r=Vt(t),[n,i]=K(e),o=l(n,i,1);for(let e=0;e<o.length;e++){let[l,n]=o[e],i=qt(r,l,n);if(i){let e=Ot(i);if(e===Lt||e===At)return Al("unlock"),Bt(r,l,n,Ct),e===At&&y(r.lvl,l,n,r,!0),setTimeout(()=>{F(t)}),!0}}return Tl("You are nearby nothing to unlock!"),Al("cancel"),!1}},10],Te=[2,"Knife",{getDmg:()=>[4,8]},5],De=[3,"Sword",{getDmg:()=>[8,16]},10],Se=[3,"Fine Sword",{getDmg:()=>[16,24]},50],$e=[6,"Scroll: Flame",{onUse:e=>be(0,e,0,[13,20],"flame")},50],ze=[6,"Scroll: Combust",{onUse:e=>(Al("flame"),be(0,e,1,[18,28],"",K(e)))},65],Ae=[6,"Scroll: Fireball",{onUse:e=>be(0,e,1,[15,25],"flame")},75],Le=[9,"Potion",{onUse:async e=>(ae(N(e),r(10,15)),!0)},50],Ce=[Te,De,xe,$e,ze,Le,_e],Fe=[[Le,3],[$e,3],[ze,2],[Ae,2]],Ie=[De,xe,Me,$e,ze,Se,Le],Pe=[[Ae,2],[$e,5],[Le,5]],qe=[Me,Ee,Se,$e,Le,[Le,2],_e],Be=[[4,"Magic Sword",{getDmg:()=>[24,32]},100],[[6,"Scroll: Eviscerate",{onUse:async e=>be(0,e,0,[32,40],"flame")},200],3]],Ge=e=>[e,e],He=[2,1,"mG",Ge(6),1],Re=[4,1,"G",Ge(14),1],Ue=[6,1,"C",Ge(17),1],Ye=[10,1,"MG",Ge(38),1],Ne=[[He,4,6,12,Te],[Re,4,6,10,Te]],Xe=[[He,0,2,12,De],[Re,2,6,10,Te],[Ue,1,4,4,Te],[Ye,1,2,10,De]],We=[[Re,0,2,12,De],[Ue,2,5,10,Te],[Ye,8,10,10,De]],Oe=[1,3,4],je=[2,5,6,7],Ke=[8],Qe=[9,10,11],Ve=[14],Je=[12,13],Ze=(e,t)=>[e%t,Math.floor(e/t)],et=(e,t,l)=>t*l+e,tt=()=>n(["","_r1","_r2","_r3","_f"]),lt=(e,t)=>{let l=cl(),r=e*l;return t.tiles.slice(r,r+l)},rt=(e,t)=>{let l=[],r=cl();for(let n=0;n<cl();n++)l.push(t.tiles[e+n*r]);return l},nt=(e,t)=>t.rooms.filter(t=>t.lvl===e),it=(e,t,l)=>{let r=[],n=[e],i=[],o=t=>{t&&(t.lvl!==l||r.includes(t)?t.lvl!==e.lvl||i.includes(t)||n.push(t):r.push(t))};do{let e=n.shift();i.push(e),ot(e,t).forEach(o)}while(n.length);return r},ot=(e,t)=>{let l=ul(),[r,n]=Ze(t.rooms.indexOf(e),l);return[dl(r,n-1,t),dl(r,n+1,t),dl(r-1,n,t),dl(r+1,n,t)]},at=(e,t,l)=>{let r=cl();ot(e,l).forEach((l,n)=>{let i=t=>{((e,t)=>{t[0]="t_"+e,t[1]=e})(e.tiles[r+1][1],t)};if(l===t)switch(n){case 0:lt(0,e).slice(4,-4).forEach(i);break;case 1:lt(r-1,e).slice(4,-4).forEach(i);break;case 2:rt(0,e).slice(4,-4).forEach(i);break;case 3:rt(r-1,e).slice(4,-4).forEach(i)}})},st=(e,t,l)=>{let r=()=>n(1===e?Oe:2===e?Ke:Ve);e>1&&(t.lvl=e,t.mod=tt(),t.id=r());for(let i=0;i<4;i++){let i=it(t,l,0);if(i.length){let t=n(i);t.lvl=e,t.mod=tt(),t.id=r()}}},ft=(e,t)=>{let l=(e,t,l,n)=>[r(e,e+l),r(t,t+n)],n=(e,t,l)=>{let r=qt(l,e,t),n=It(l,e,t);return!(!jt(r)||null!==n)},i=cl();t.forEach(t=>{let o,a,[s,f,c,u,h]=t,d=i/2-u/2,m=0,p=r(f,c+1);for(let t=0;t<p;t++){let t=!1;do{let[e,r]=l(d,d,u,u);if(o=e,a=r,m++,m>10){t=!0;break}}while(!n(o,a,e));if(t)continue;let[r,i,f,c,p]=s,g=[f,"a",r,o,a,[...c],[h],0,p,!0,!1,i,0,0];e.a.push(g)}})},ct={5011569:0,634050:1,255255255:2,25523198:3,256163:4,357193:5,"000":6,79103129:7,606060:8,803030:9,18411180:10,4132209:11,2295968:12,44232244:13,25114643:14,175191210:15},ut=e=>{let t=[0,0,["player","a",0,9,12,Ge(100),[Te,[Le,3]],0,0,!0,!1,0,0,0],0],l={rooms:[],p:[],player:t,end:[]},r=ul(),i=cl(),o=r*r;for(let e=0;e<o;e++){let e={lvl:0,id:15,tiles:[],p:[],visMap:q([i,i]),explMap:q([i,i]),items:[],a:[],mod:""};l.rooms.push(e)}let a=n(l.rooms);a.lvl=1,a.id=0;let s,f=l.rooms.indexOf(a),[c,u]=Ze(f,r);Dt(t,c,u);do{s=n(l.rooms)}while(s===a);s.lvl=4,s.id=15,s.mod="";let h=l.rooms.indexOf(s);l.end=Ze(h,4),st(1,a,l);let d=n(it(a,l,0));st(2,d,l);let m=it(d,l,0),p=n(m.length?m:it(a,l,0));if(st(3,p,l),nt(3,l).length<=2||nt(2,l).length<=2)return ut(e);nt(0,l).forEach(e=>{e.lvl=1,e.mod=tt(),e.id=n(Oe)}),n(nt(1,l).filter(e=>e!==a)).id=n(je),n(nt(2,l)).id=n(Qe),n(nt(3,l)).id=n(Je);let g=(e,t)=>["t_14",14,e,t,!1];for(let t=0;t<o;t++){let{tiles:r,id:n,mod:o}=l.rooms[t],[,a]=ye(16,16);Fl(e+"_"+n+o,0,0,1,a);let{data:s}=a.getImageData(0,0,16,16);for(let e=0;e<i*i;e++){let[t,l]=Ze(e,i);r.push(g(t,l))}let f=0;for(let e=0;e<s.length;e+=4){let t=ct[`${s[e+0]}${s[e+1]}${s[e+2]}`]||0,l=1+f%16,n=1+Math.floor(f/16);r[et(l,n,i)]=["t_"+t,t,l,n,!1],f++}}for(let e=0;e<o;e++){let t=l.rooms[e];ot(t,l).forEach(e=>{e&&e.lvl===t.lvl&&at(t,e,l)})}let w=n(it(a,l,2));ot(w,l).forEach(e=>{e&&1===e.lvl&&(at(w,e,l),at(e,w,l))});let v=it(w,l,3),b=n(v.length?v:it(a,l,3));ot(b,l).forEach(e=>{e&&2===e.lvl&&(at(b,e,l),at(e,b,l))}),ot(s,l).forEach(e=>{e&&(at(s,e,l),at(e,s,l))}),nt(1,l).forEach(e=>{e!==a&&ft(e,Ne)}),nt(2,l).forEach(e=>{ft(e,Xe)}),nt(3,l).forEach(e=>{e!==s&&ft(e,We)});let k=[name,"a",12,4,12,Ge(100),[],0,0,!0,!1,2,0,0];return a.a.push(k),y(1,4,6,a),y(1,13,3,a),l},ht=e=>e[1],dt=e=>"misc_"+e[0],mt=e=>2===e.length?e[0]:e,pt=e=>2===e.length?e[1]:1,gt=(e,t)=>{if(2===e.length){let l=e[1]+t;return l<0&&(l=0),e[1]=l,l?e:null}return t>0?[e,1+t]:null},yt=e=>mt(e)[3],wt=e=>!!vt(e),vt=e=>mt(e)[2].onUse,bt=e=>{let t=mt(e)[2].onAcq;return!t||t()},kt=e=>!!mt(e)[2].getDmg,xt=(e,t)=>{let l=e[2];return l.getDmg?l.getDmg(t):[0,0]},Mt=e=>e[2],Et=e=>[e[0],e[1]],_t=e=>e[3],Tt=(e,t)=>{e[3]+=t},Dt=(e,t,l)=>{e[0]=t,e[1]=l},St=(e,t)=>{let l=Vt(t),r=Mt(e),[n,o]=K(r);return 0===l.id&&i(n,o,3,11,5,13)},$t=[3,4,5,6,9,10,11,12,13,14],zt=[3,4,5,6,14],At=10,Lt=9,Ct=0,Ft=(e,t,l,r)=>["misc_"+e,+new Date,500,t,l,r],It=(e,t,l)=>{for(let r=0;r<e.a.length;r++){let n=e.a[r],[i,o]=K(n);if(i===t&&o===l)return n}let r=fl();if(r){let e=Mt(r.player),[n,i]=K(e);if(n===t&&i===l)return e}return null},Pt=(e,t)=>{e.p.push(t)},qt=(e,t,l)=>{let r=cl();return t<0||t>=r||l<0||l>=r?null:e.tiles[l*cl()+t]},Bt=(e,t,l,r)=>{let n=qt(e,t,l);n&&(n[0]="t_"+r,n[1]=r)},Gt=(e,t,l,r)=>{e.items.push([t,l,r])},Ht=(e,t,l)=>{let r=[];for(let n=0;n<e.items.length;n++){let[,i,o]=e.items[n];t===i&&l===o&&r.push(e.items[n])}return r},Rt=(e,t,l,r)=>{let{items:n}=e;for(let e=0;e<n.length;e++){let[i,o,a]=n[e];if(l===o&&r===a&&t===ht(mt(i)))return n.splice(e,1),!0}return!1},Ut=(e,t)=>{let l=[],[r,n]=K(t);for(let t=-1;t<=1;t++)for(let i=-1;i<=1;i++)l=l.concat(Ht(e,r+i,n+t));return l},Yt=(e,t,l)=>!!e.visMap[l][t],Nt=(e,t,l)=>!!e.explMap[l][t],Xt=(e,t)=>{Wt(t);for(let l=0;l<e.length;l++){let[r,n]=e[l];Qt(qt(t,r,n),!0)}},Wt=e=>{for(let t=0;t<e.tiles.length;t++)Qt(e.tiles[t],!1)},Ot=e=>(null==e?void 0:e[1])||0,jt=e=>!$t.includes(Ot(e)),Kt=e=>zt.includes(Ot(e)),Qt=(e,t)=>{e&&(e[4]=t)},Vt=e=>{let t=e.player,[l,r]=Et(t),n=ul();return e.rooms[r*n+l]},Jt=null,Zt=!1,el=!1,tl=-1,ll=null,rl=null,nl="",il="",ol=!1,al=()=>2,sl=e=>Jt=e,fl=()=>Jt,cl=()=>18,ul=()=>4,hl=()=>16,dl=(e,t,l)=>{let r=ul();return e<0||t<0||e>=r||t>=r?null:l.rooms[t*r+e]||null},ml=()=>Zt,pl=e=>Zt=e,gl=e=>ll=e,yl=()=>ll,wl=e=>el=e,vl=()=>el,bl=e=>tl=e,kl=()=>bl(-1),xl=()=>rl,Ml=e=>{rl=e},El=e=>R=e,_l=()=>R,Tl=e=>nl=e,Dl=e=>il=e,Sl=e=>ol=e,$l=()=>ol,zl={start:[,,17,.05,.21,.09,,2.92,,23,,,,,,.1,.37,,1],strike:[,0,822,.1,.08,.13,4,2.12,-12,-9.3,,,,,.2],dead:[2,,449,.01,,.08,3,2.15,-10,,,,,,,.2,.12,.36,.01],lose:[.3,,306,.08,.2,.83,2,.92,,-1.7,-5,.06,.18,,,.1,,.87,.09],eqp:[.5,,1966,,.13,0,4,1.15,-18,,,,,.1,-.6,,,.1,.06],use:[,,19,.01,,.05,4,.55,-.2,.8,,.04,,.4,-5,,,,.02],flame:[,,569,.01,,.42,3,.3,,.6,,,,1.1,3,,.16,.92],sell:[,0,853,.04,,,1,2.63,,.3,,,,,-.4,,.14,.13,.01],gold:[,0,457,,.23,,1,1.58,,,,,.07,,,,,.69],acquire:[.3,,14,.03,,.07,3,.3,,48,,,,,,,,,.04],cancel:[,0,177,.02,,.07,,.21,,-.4,764,.11,,,,,.06,.28,.03],talk:[,.3,527,.02,.03,0,2,.18,,-70,13,,,.1,,.6,.11],unlock:[,,823,.01,.03,0,3,.01,22,,,,.04,,6.3,,.18,,.06],win:[,,1257,.17,.17,.16,,.56,,,669,,.53,.8,-4.6,,.23,.8,.15]},Al=e=>{H=.3,G(...zl[e])},Ll=()=>{let e=we();Il(0,0,e.width,e.height,"#333")},Cl=(e,t)=>{(t=t||ve()).globalAlpha=e},Fl=(e,t,l,r,n)=>{r=r||1,n=n||ve();let[i,o,a,s,f]="string"==typeof e?he[e]:e;n.drawImage(i,o,a,s,f,t,l,s*r,f*r)},Il=(e,t,l,r,n,i,o)=>{(o=o||ve())[i?"strokeStyle":"fillStyle"]=n,o[i?"strokeRect":"fillRect"](e,t,l,r)},Pl=(e,t,l,r)=>{let[n,i]=K(e),o=(e=>e[1]+"_"+(e[2]+(e[10]?1:0))+(e[7]===U?"_f":""))(e),a=hl()*t;Fl(o,l+n*a,r+i*a,t)},ql=(e,t,l,r)=>{t=t||1;let[n,,,i,o,a]=e,s=hl(),f=s*t/2,c=s*t,u=l+i*c,h=r+o*c;if(n&&Fl(n,u,h,t),a){let e=ve();e.font="16px monospace",e.fillStyle="#FFF",e.fillText(a,u+f-(2===a.length?9:5),h+f+5)}},Bl=(e,t,l,r,n,i)=>{let o=dt(e),a=hl()*r;Fl(o,n+t*a+8,i+l*a+8,r-1)},Gl=(e,t)=>{let l=ul(),r=hl(),n=e.player,[i,o]=Et(n),a=r*t,s=e.rooms[o*l+i];for(let e in s.tiles){let[l,,r,n]=s.tiles[e],i=r*a,o=n*a;Nt(s,r,n)?Fl(l,i,o,t):Il(i,o,a,a,"#333",!0)}for(let e in s.items){let[l,r,n]=s.items[e],i=mt(l);Yt(s,r,n)&&Bl(i,r,n,t,0,0)}for(let e in s.tiles){let[,,l,r,n]=s.tiles[e],i=It(s,l,r),o=l*a,f=r*a;Yt(s,l,r)?i&&Pl(i,t,0,0):Nt(s,l,r)&&(Cl(.15),Il(o,f,a,a,"black",!1),Cl(1)),n&&Il(o,f,a,a,"#ddd",!0)}let f=Mt(n);Pl(f,t,0,0);for(let e=0;e<s.p.length;e++)ql(s.p[e],t,0,0)},Hl=0,Rl=0,Ul="div",Yl=(e,t)=>{e.appendChild(t)},Nl=(e,t)=>{e.className=t},Xl=e=>document.getElementById(e),Wl=(e,t,l)=>{let r=document.createElement(e);return t&&(r.innerHTML=t),l&&Ol(r,l),r},Ol=(e,t)=>{for(let l in t)e.style[l]=t[l]},jl=(e,t,l,r)=>{let n=Xl("tgt");Ol(n,{display:"block"});let i=n.children[0];i.setAttribute("x1",""+e),i.setAttribute("x2",""+l),i.setAttribute("y1",""+t),i.setAttribute("y2",""+r)},Kl=()=>{wl(!1),Ol(Xl("tgt"),{display:"none"})},Ql=(e,t,l,r)=>{let n=Wl(Ul);if(Nl(n,"item hrz"),e){let r=mt(e),i=pt(e),o=ht(r),a=dt(r),s=V(l)===e;Ol(n,{"justify-content":"flex-start"}),t===tl&&Ol(n,{background:"#444"});let f=Wl(Ul);Nl(f,"vrt menu-item-ctr");let c=e=>()=>{let r=l[12],n=((e,t,l)=>{let r=e+l;if(r<0||r>=t.length)return e;let n=t[e];return t[e]=t[e+l],t[e+l]=n,e+l})(t,X(l),e),i=r;n===r&&(i=r-e),s&&(i=t+e),J(l,i),Jl()},u="cyc-item",h=Wl(Ul,"up");Nl(h,u),h.onclick=c(-1),Yl(f,h);let d=Wl(Ul,"dn");Nl(d,u),d.onclick=c(1),Yl(f,d),Yl(n,f);let m=Wl(Ul,t+1+". ");Ol(m,{margin:"5px",width:"20px"}),Yl(n,m);let p=Wl(Ul);Nl(p,"vrt menu-item-ctr"),Yl(n,p);let g=fl();if(St(g.player,g)){let t=Wl(Ul,"SELL");t.onclick=()=>{((e,t)=>{Al("sell");let l=yt(e);Tt(t,l);let r=Mt(t);j(r,e),Jl()})(e,fl().player)},Nl(t,"menu-item"),Ol(t,{background:"#994"}),Yl(p,t);let l=Wl(Ul,yt(e)+" gold ");Ol(l,{"text-align":"center",color:"#FFE762",margin:"5px",width:"32px"}),Yl(n,l)}else{if(wt(e)){let e=Wl(Ul,"USE");Nl(e,"menu-item"),e.onclick=async()=>{bl(t),v(r,l)},Yl(p,e)}if(kt(e)&&!s){let e=Wl(Ul,"EQP");e.onclick=()=>{b(t,l)},Nl(e,"menu-item"),Yl(p,e)}}let[y,w]=ye(32,32);Ol(y,{margin:"2px"}),Fl(a,0,0,2,w),Yl(n,y);let k=Wl(Ul,`${o} ${i>1?"("+i+")":""}`,{width:"90px"});s&&Ol(k,{color:"#9ef"}),Yl(n,k)}Yl(r,n)},Vl=(e,t,l,r,n,i,o)=>{let a=Wl(Ul);if(Nl(a,"item hrz"),Ol(a,{width:"155px",background:"#555"}),e){let o=mt(e),s=pt(e),f=ht(o),c=dt(o),[u,h]=ye(32,32);Ol(u,{margin:"2px"}),Fl(c,0,0,2,h),Ol(a,{"justify-content":"flex-start"});let d=Wl("span",String.fromCharCode(t+65).toLowerCase()+"."),m=Wl("span",`${f} ${s>1?"("+s+")":""}`);Yl(a,d),Yl(a,u),Yl(a,m),a.onclick=()=>{k(e,i,r,n,l)}}Yl(o,a)},Jl=()=>{let e=fl(),l=Xl("invDiv");l.innerHTML="";let r=Xl("infoDiv");r.innerHTML="";let n=Xl("cutDiv");n.innerHTML="",$l()||_l()?Ol(r,{width:"0"}):(Ol(r,{width:""}),((e,t)=>{let l=Wl(Ul);l.onscroll=()=>{Hl=l.scrollTop},Nl(l,"inventory");let r=Wl(Ul,"INVENTORY");Nl(r,"title"),Yl(l,r);let n=Mt(e),i=X(n);for(let e=0;e<10;e++)Ql(i[e],e,n,l);Yl(t,l),l.scrollTop=Hl})(e.player,l),((e,l)=>{let r=Wl(Ul);Nl(r,"ctrl info-item hrz");let n=Wl(Ul,"Reset",{width:"80px"});Nl(n,"menu-item"),Yl(r,n),n.onclick=()=>{t()};let i=Wl(Ul);Nl(i,"pickup info-item"),i.onscroll=()=>{Rl=i.scrollTop},((e,t,l)=>{let r=Wl(Ul,"NEARBY ITEMS");Nl(r,"title"),Yl(l,r);let n=Mt(e),i=Ut(t,n);for(let e=0;e<i.length;e++){let[r,o,a]=i[e];Vl(r,e,t,o,a,n,l)}})(e.player,Vt(e),i),Yl(l,r),((e,t)=>{let l=Mt(e),r=Wl(Ul);Nl(r,"stats info-item");let n=Wl(Ul);Ol(n,{padding:"8px","font-size":"22px"});let i=Wl(Ul,`Gold: ${_t(e)}/404`,{color:"#FFE762"});Yl(n,i);let o=N(l),a=se(o),s=(e=>e[1])(o),f=Wl(Ul,`HP: ${a}/${s}`,{color:a<s?"#FB922B":""});Yl(n,f);let[c,u]=fe(l),h=Wl(Ul,`DMG: ${c}-${u}`);Yl(n,h),Yl(r,n),Yl(t,r)})(e.player,l),Yl(l,i),i.scrollTop=Rl})(e,r)),((e,l)=>{let r=nl,n=Wl(Ul);if(Ol(n,{margin:"25px 0","font-size":"1.25rem"}),Yl(l,n),_l()){let e;$l()?(r="You are victorious.",e=Wl(Ul,"Again!",{padding:"5px"}),Nl(e,"menu-item dona"),e.onclick=()=>{Sl(!1),El(!1),t()}):(e=Wl(Ul,"Press any key"),Ol(e,{margin:"100px",position:"absolute",top:"0",color:"#bbb"})),Yl(l,e)}else{let t=Wl(Ul,"NumPad/Arrows: move, Num5/Space: wait | Move into enemies to strike",{position:"fixed",top:"5px"});Yl(l,t);let n=e.player;if(((e,t)=>{let l=Vt(t),r=Mt(e),[n,o]=K(r);return 0===l.id&&i(n,o,8,7,10,9)})(n,e)&&(r=_t(n)>=404?'You may enter...<div class="menu-item dona" onclick="window.finalRoom()">Donate Coins</div>':"More gold is required... "),St(n,e)&&(r="What're ya sellin'?"),!r)return void Ol(l,{"min-height":"0px",height:"0px",border:"0"})}Ol(l,{display:"flex","min-height":"90px",border:"2px outset #777"}),n.innerHTML=r;let[o,a]=ye(32,32);Ol(o,{margin:"250px",position:"absolute",top:"0"}),il&&Fl(il,0,0,2,a),Yl(l,o)})(e,n),Ol(document.body.children[0],{display:"flex"})}})();